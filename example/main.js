var canvas = document.getElementById('oled');
var screen = new Screen(canvas);

d0 = [0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0xf8,0xfc,0xe4,0xfc,0xfc,0xfc,
    0xfc,0xfc,0xfc,0xf8,0x00,0x00,0x00,0x00, 0xfc,0xf0,0xe0,0xc0,0xc0,0xe0,0xf0,0xf0,
    0xf8,0xfc,0xff,0xff,0xff,0xff,0x13,0x32, 0x02,0x02,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x01,0x03,0x07,0x0f,0xff,0xbf,0x1f, 0x0f,0x0f,0x1f,0x17,0x03,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00];

d3 = [0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0xf8,0xfc,0xe4,0xfc,0xfc,0xfc,
    0xfc,0xfc,0xfc,0xf8,0x00,0x00,0x00,0x00, 0xfc,0xf0,0xe0,0xc0,0xc0,0xe0,0xf0,0xf0,
    0xf8,0xfc,0xff,0xff,0xff,0xff,0x13,0x32, 0x02,0x02,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x01,0x03,0x07,0x0f,0xff,0xbf,0x1f, 0x0f,0x1f,0xff,0x87,0x03,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00];

d2 = [0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0xc0,0xe0,0x20,0xe0,0xe0,0xe0,
    0xe0,0xe0,0xe0,0xc0,0x00,0x00,0x00,0x00, 0xe0,0x80,0x00,0x00,0x00,0x00,0x80,0x80,
    0xc0,0xe0,0xff,0xff,0xff,0xff,0x9f,0x97, 0x17,0x17,0x07,0x07,0x00,0x00,0x00,0x00,
    0x07,0x0f,0x1f,0x3e,0x7e,0xff,0xff,0xff, 0x7f,0xff,0xff,0x3f,0x1f,0x07,0x00,0x01,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x07,0x05,0x00,
    0x00,0x00,0x07,0x04,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00];

d1 = [0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0xf8,0xfc,0xe4,0xfc,0xfc,0xfc,
    0xfc,0xfc,0xfc,0xf8,0x00,0x00,0x00,0x00, 0xfc,0xf0,0xe0,0xc0,0xc0,0xe0,0xf0,0xf0,
    0xf8,0xfc,0xff,0xff,0xff,0xff,0x13,0x32, 0x02,0x02,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x01,0x03,0x07,0x0f,0x1f,0x3f,0x2f, 0x0f,0x1f,0xff,0x87,0x03,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00];

p = [0x00,0x00,0x80,0xc0,0x80,0x00,0xfe,0xff, 0xff,0xfe,0x00,0xc0,0xe0,0xc0,0x00,0x00,
    0x00,0x00,0x7f,0xff,0xff,0xc0,0xff,0xff, 0xff,0xff,0xc0,0xff,0x7f,0x3f,0x00,0x00,
    0x00,0x00,0x00,0x00,0x01,0x01,0xff,0xff, 0xff,0xff,0x00,0x00,0x00,0x00,0x00,0x00];

o0 = [0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0xf8,0xfc,0xe4,0xfc,0xfc,0xfc,
    0xfc,0xfc,0xfc,0xf8,0x80,0x00,0xfe,0xff, 0xff,0xfe,0x00,0xc0,0xe0,0xc0,0x00,0x00,
    0xfc,0xf0,0xe0,0xc0,0xc0,0xe0,0xf0,0xf0, 0xf8,0xfc,0xff,0xff,0xff,0xff,0x13,0x32,
    0x02,0x02,0x7f,0xff,0xff,0xc0,0xff,0xff, 0xff,0xff,0xc0,0xff,0x7f,0x3f,0x00,0x00,
    0x00,0x01,0x03,0x07,0x0f,0xff,0xbf,0x1f, 0x0f,0x1f,0xff,0x87,0x03,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x01,0x01,0xff,0xff, 0xff,0xff,0x00,0x00,0x00,0x00,0x00,0x00];
    
o1 = [0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0xc0,0xe0,0x20,0xe0,0xe0,0xe0,
    0xe0,0xe0,0xe0,0xc0,0x00,0x00,0x00,0x00, 0xe0,0x80,0x00,0x00,0x00,0x00,0x80,0x80,
    0xc0,0xe0,0xff,0xff,0xff,0xff,0x9f,0x97, 0x17,0x17,0x07,0x07,0x00,0x00,0x00,0x00,
    0x07,0x0f,0x1f,0x3e,0x7e,0xff,0xff,0xff, 0x7f,0xff,0xff,0x3f,0x1f,0x07,0x00,0x01,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x80,0xc0,0x80,0x07,0xff,0xff,
    0xff,0xfe,0x07,0xc4,0xe0,0xc0,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x7f,0xff,0xff,0xc0,0xff,0xff, 0xff,0xff,0xc0,0xff,0x7f,0x3f,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x01,0x01,0xff,0xff,
    0xff,0xff,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00];

    screen.draw(16, 5, 40, 8, d0);

var run = 0;
var jump = 0;
var cactus = 0;
var score = 0;
var over = false;
var shouldJump = false;

window.onkeydown = function(event) {
    if (event.which === 32) {
        shouldJump = true;
    }
}

function loop() {
    if (over) {
        return;
    }

    if (shouldJump) {
        if (jump == 0) {
            jump = 1;
        }
        shouldJump = false;
    }

    if (cactus == 0 && Math.random() * 10 > 5) {
        cactus = 1;
    } else if (cactus > 8) {
        cactus = 0;
    }

    screen.clear();

    if (jump != 1 && cactus == 6) {
        screen.print(2, '      Game Over!', false);
        if (jump == 0) {
            screen.draw(16, 4, 48, 8, o0);
        } else {
            screen.draw(16, 2, 40, 8, o1);
        }

        screen.print(0, `Score: ${score}`, false);
        over = true;
        return;
    }

    if (jump == 1) {
        screen.draw(16, 3, 40, 7, d2);
        jump = 2;
    } else if (jump == 2) {
        screen.draw(16, 2, 40, 5, d3);
        jump = 3;
    } else if (jump == 3) {
        screen.draw(16, 3, 40, 7, d2);
        jump = 0;
    } else if (run == 0) {
        screen.draw(16, 5, 40, 8, d0);
        run = 1;
    } else if (run == 1) {
        screen.draw(16, 5, 40, 8, d1);
        run = 0;
    }

    if (cactus > 0) {
        screen.draw((8 - cactus) * 16, 5, (9 - cactus) * 16, 8, p);
        cactus++;
    }

    score++;
}

setInterval(loop, 125);